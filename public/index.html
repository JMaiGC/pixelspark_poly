<!DOCTYPE html>

<html>
  <head>
    <title>LLMD client</title>
  </head>

  <body>
    <div class="bar">
      <input id="prompt" placeholder="Prompt..." onkeyup="promptKeyup(event)" />
      <select id="model">
        <option>Loading...</option>
      </select>
    </div>

    <textarea id="results" readonly disabled></textarea>

    <script>
      const server = "";
      const maxTokens = 50;
      let eventSource = null;
      const modelSelect = document.getElementById("model");

      fetch(server + "/model").then(async (e) => {
        const data = await e.json();
        modelSelect.childNodes.forEach((e) => modelSelect.removeChild(e));
        for (const m of data.models) {
          const opt = document.createElement("OPTION");
          opt.value = m;
          opt.innerText = m;
          modelSelect.appendChild(opt);
          modelSelect.value = m;
        }
      });

      function promptKeyup(e) {
        if (e.keyCode === 13) {
          // Enter key pressed

          const prompt = document.getElementById("prompt").value;

          if (eventSource !== null) {
            eventSource.close();
            eventSource = null;
          }

          const model = modelSelect.value;

          eventSource = new EventSource(
            server +
              "/model/" +
              model +
              "/live?max_tokens=" +
              maxTokens +
              "&prompt=" +
              encodeURIComponent(prompt)
          );
          document.getElementById("results").value = "";

          eventSource.onmessage = function (e) {
            document.getElementById("results").value += e.data;
          };

          eventSource.onerror = function (e) {
            eventSource.close();
          };
        }
      }
    </script>

    <style type="text/css">
      * {
        box-sizing: border-box;
        font-family: Verdana;
      }

      html,
      body {
        padding: 0;
        margin: 0;
      }

      body {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      input#prompt {
        padding: 5px;
      }

      textarea#results {
        height: 200px;
        padding: 5px;
        margin: 5px;
      }

      .bar {
        display: flex;
        flex-direction: row;
        margin: 5px;
      }

      .bar > input {
        flex: 1;
      }
    </style>
  </body>
</html>
